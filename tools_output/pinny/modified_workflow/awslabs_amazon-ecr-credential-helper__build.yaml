name: Build
on:
push:
branches: [ main ]
pull_request:
branches: [ main ]
jobs:
git-secrets:
runs-on: 'ubuntu-22.04'
steps:
- name: Pull latest awslabs/git-secrets repo
uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # actions/checkout@v4 | v4.2.2
with:
repository: awslabs/git-secrets
ref: 1.3.0
fetch-tags: true
path: git-secrets
- name: Install git secrets from source
run: sudo make install
working-directory: git-secrets
- uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # actions/checkout@v4 | v4.2.2
- name: Scan repository for git secrets
run: |
git secrets --register-aws
git secrets --scan-history
cross-compile:
runs-on: 'ubuntu-22.04'
steps:
- uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # actions/checkout@v4 | v4.2.2
- name: Cross-compile all variants
run: make all-variants-in-docker
unit-test:
strategy:
matrix:
go: ['1.22', '1.23']
# Intentionally use specific versions instead of "latest" to
# make this build reproducible.
os: ['ubuntu-22.04', 'macos-13', 'windows-2022']
# Build all variants regardless of failures
fail-fast: false
name: unit-test (${{ matrix.os }} / Go ${{ matrix.go }})
runs-on: ${{ matrix.os }}
steps:
- uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # actions/checkout@v4 | v4.2.2
- uses: actions/setup-go@d35c59abb061a4a6fb18e82ac0862c26744d6ab5 # actions/setup-go@v5 | v5.5.0
with:
go-version: ${{ matrix.go }}
- run: make test